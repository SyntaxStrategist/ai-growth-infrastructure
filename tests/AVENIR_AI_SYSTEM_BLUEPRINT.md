# üèóÔ∏è Avenir AI Solutions ‚Äî System Blueprint

**Version:** 2.0.0  
**Last Updated:** October 17, 2025  
**Status:** Production Ready  

---

## üìã Table of Contents

1. [System Overview](#system-overview)
2. [Architecture Modules](#architecture-modules)
3. [API Endpoints](#api-endpoints)
4. [Frontend Pages](#frontend-pages)
5. [Database Schema](#database-schema)
6. [Data Flow](#data-flow)
7. [Integrations](#integrations)
8. [Key Features](#key-features)

---

## üéØ System Overview

**Avenir AI Solutions** is a complete bilingual (EN/FR) AI growth infrastructure platform that:

- ‚úÖ Captures and enriches leads with AI intelligence
- ‚úÖ Provides personalized automated email responses
- ‚úÖ Enables client-specific dashboard analytics
- ‚úÖ Discovers and scores potential prospects autonomously
- ‚úÖ Supports multi-tenant architecture with API key authentication
- ‚úÖ Offers admin command center for global oversight

**Technology Stack:**
- **Frontend:** Next.js 15.5.4, React 19, TailwindCSS, Framer Motion
- **Backend:** Next.js API Routes (Edge Runtime)
- **Database:** Supabase (PostgreSQL)
- **AI:** OpenAI GPT-4o-mini
- **Email:** Gmail API + SMTP
- **Internationalization:** next-intl
- **Authentication:** bcryptjs, API Keys, Session Storage
- **Testing:** Playwright, Custom E2E Scripts

---

## üß© Architecture Modules

### 1Ô∏è‚É£ **Public Marketing Site**
- **Location:** `/[locale]/page.tsx`
- **Features:**
  - Bilingual hero section with animated logo
  - Infrastructure framework cards (4 pillars)
  - Live AI assistant demo
  - Lead capture form with AI enrichment
  - Bridge animation showing AI flow
- **Language Toggle:** Original `LanguageToggle` component
- **Routes:** `/en`, `/fr`

### 2Ô∏è‚É£ **Client Area**
- **Location:** `/[locale]/client/*`
- **Features:**
  - Signup with personalization fields (industry, service, tone, etc.)
  - Login with session management
  - Dashboard with AI analytics (mirrored from admin)
  - Settings page with email template preview
  - API access page with integration docs
- **Language Toggle:** `UniversalLanguageToggle` (top-right, z-60)
- **Routes:**
  - `/[locale]/client/signup`
  - `/[locale]/client/login`
  - `/[locale]/client/dashboard`
  - `/[locale]/client/settings`
  - `/[locale]/client/api-access`

### 3Ô∏è‚É£ **Admin Area**
- **Location:** `/[locale]/admin/*` and `/[locale]/dashboard/*`
- **Features:**
  - Command Center with client filtering
  - Global lead analytics and management
  - Predictive Growth Engine
  - Lead tagging (Active, Follow-Up, Converted, Archived, Deleted)
  - Admin settings for managing client preferences
  - Prospect Intelligence dashboard
- **Language Toggle:** `UniversalLanguageToggle` (top-right, z-60)
- **Routes:**
  - `/[locale]/admin/login`
  - `/[locale]/dashboard` (main admin dashboard)
  - `/[locale]/admin/settings`
  - `/[locale]/admin/prospect-intelligence`
  - `/[locale]/dashboard/insights`
  - `/[locale]/dashboard/clients`

### 4Ô∏è‚É£ **Personalized Email Automation**
- **Location:** `/lib/personalized-email.ts`
- **Features:**
  - Client-specific email templates
  - Dynamic tone (Friendly, Professional, Formal, Casual)
  - Industry and service mentions
  - Booking link integration
  - Custom tagline support
  - Bilingual email generation
  - SMTP integration (client's own email server)
- **Trigger:** Automatic on new lead creation via `/api/lead`

### 5Ô∏è‚É£ **Prospect Intelligence Module**
- **Location:** `/prospect-intelligence/*`
- **Features:**
  - Autonomous prospect discovery (simulated Google Search)
  - Contact form testing and response time measurement
  - Automation need scoring (0-100)
  - Outreach email generation
  - High-priority prospect filtering
  - Admin dashboard integration
- **API Routes:**
  - `/api/prospect-intelligence/scan`
  - `/api/prospect-intelligence/prospects`

### 6Ô∏è‚É£ **AI Intelligence Engine**
- **Location:** `/lib/ai-enrichment.ts`, `/api/intelligence-engine/*`
- **Features:**
  - Lead intent detection
  - Tone analysis (Professional, Friendly, Urgent, etc.)
  - Urgency scoring (High, Medium, Low)
  - Confidence scoring (0-1)
  - AI summary generation
  - Relationship insights
  - Growth predictions
- **Trigger:** 
  - On demand via dashboard button
  - Daily cron job at 03:00 UTC

### 7Ô∏è‚É£ **Smart Redirect System**
- **Location:** `/src/middleware.ts`
- **Features:**
  - Auto-redirects base routes to locale-prefixed routes
  - 3-tier locale detection (cookie ‚Üí browser ‚Üí default)
  - 11 shortcut URLs supported
  - Cookie-based preference storage
- **Example:** `/client/login` ‚Üí `/en/client/login` or `/fr/client/login`

### 8Ô∏è‚É£ **Universal Language Toggle**
- **Location:** `/src/components/UniversalLanguageToggle.tsx`
- **Features:**
  - Fixed top-right positioning (z-60)
  - 18px font, purple glow on active
  - Triple persistence (localStorage + Supabase + cookie)
  - Hover tooltip
  - Toast notifications
  - Only active on `/client/*` and `/admin/*` pages

---

## üîå API Endpoints

### **Public Endpoints**

| Endpoint | Method | Purpose | Authentication |
|----------|--------|---------|----------------|
| `/api/chat` | POST | AI assistant chat completion | None |
| `/api/lead` | POST | Lead submission with AI enrichment | x-api-key (optional) |

### **Client Endpoints**

| Endpoint | Method | Purpose | Authentication |
|----------|--------|---------|----------------|
| `/api/client/register` | POST | Client signup | None |
| `/api/client/auth` | POST | Client login | Email + Password |
| `/api/client/leads` | GET | Fetch client-scoped leads | Session |
| `/api/client/settings` | GET, PUT | Get/update client settings | clientId query param |
| `/api/client/update-language` | PUT | Update client language | clientId |

### **Admin Endpoints**

| Endpoint | Method | Purpose | Authentication |
|----------|--------|---------|----------------|
| `/api/auth-dashboard` | POST | Admin login | ADMIN_PASSWORD |
| `/api/leads` | GET | Fetch all leads (global or filtered) | Admin session |
| `/api/leads/archived` | GET | Fetch archived leads | Admin session |
| `/api/leads/deleted` | GET | Fetch deleted leads | Admin session |
| `/api/leads/insights` | GET | Fetch relationship insights | Admin session |
| `/api/lead-actions` | GET, POST | Lead tagging and actions | Admin/Client session |
| `/api/clients` | GET | Fetch all clients | Admin session |

### **Intelligence & Automation Endpoints**

| Endpoint | Method | Purpose | Authentication |
|----------|--------|---------|----------------|
| `/api/intelligence-engine` | POST | Generate AI analytics | Admin session |
| `/api/intelligence-engine/cron` | GET | Daily analytics refresh | Vercel Cron |
| `/api/growth-insights` | GET | Fetch growth insights | Admin session |
| `/api/insights` | GET | Fetch AI-generated insights | Admin session |
| `/api/prospect-intelligence/scan` | POST | Run prospect discovery scan | Admin session |
| `/api/prospect-intelligence/prospects` | GET | Fetch prospect candidates | Admin session |

### **Utility Endpoints**

| Endpoint | Method | Purpose | Authentication |
|----------|--------|---------|----------------|
| `/api/rotate-key` | POST | Rotate client API key | Client session |
| `/api/gmail/auth` | GET | OAuth Gmail authorization | Admin |
| `/api/gmail/callback` | GET | Gmail OAuth callback | Admin |

---

## üñ•Ô∏è Frontend Pages

### **Public Pages (Marketing)**

| Route | Purpose | Language Toggle |
|-------|---------|-----------------|
| `/[locale]` | Homepage with AI demo | `LanguageToggle` |

### **Client Pages**

| Route | Purpose | Authentication | Language Toggle |
|-------|---------|----------------|-----------------|
| `/[locale]/client/signup` | Client registration | None | `UniversalLanguageToggle` |
| `/[locale]/client/login` | Client authentication | None | `UniversalLanguageToggle` |
| `/[locale]/client/dashboard` | Lead analytics & management | Session | `UniversalLanguageToggle` |
| `/[locale]/client/settings` | Email personalization settings | Session | `UniversalLanguageToggle` |
| `/[locale]/client/api-access` | API key & integration docs | Session | `UniversalLanguageToggle` |

### **Admin Pages**

| Route | Purpose | Authentication | Language Toggle |
|-------|---------|----------------|-----------------|
| `/[locale]/admin/login` | Admin authentication | None | `UniversalLanguageToggle` |
| `/[locale]/dashboard` | Main admin command center | Admin session | `UniversalLanguageToggle` |
| `/[locale]/admin/settings` | Manage client settings | Admin session | `UniversalLanguageToggle` |
| `/[locale]/admin/prospect-intelligence` | Prospect discovery | Admin session | `UniversalLanguageToggle` |
| `/[locale]/dashboard/insights` | Detailed analytics | Admin session | `UniversalLanguageToggle` |
| `/[locale]/dashboard/clients` | Client management | Admin session | `UniversalLanguageToggle` |

### **Shortcut URLs (Auto-Redirect)**

All base routes auto-redirect based on cookie ‚Üí browser language ‚Üí default (en):

- `/client/signup` ‚Üí `/[locale]/client/signup`
- `/client/login` ‚Üí `/[locale]/client/login`
- `/client/dashboard` ‚Üí `/[locale]/client/dashboard`
- `/client/settings` ‚Üí `/[locale]/client/settings`
- `/client/api-access` ‚Üí `/[locale]/client/api-access`
- `/admin/login` ‚Üí `/[locale]/admin/login`
- `/dashboard` ‚Üí `/[locale]/dashboard`
- `/admin/settings` ‚Üí `/[locale]/admin/settings`
- `/admin/prospect-intelligence` ‚Üí `/[locale]/admin/prospect-intelligence`
- `/dashboard/insights` ‚Üí `/[locale]/dashboard/insights`

---

## üóÑÔ∏è Database Schema

### **Table: `public.clients`**

Client accounts with personalization settings.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `client_id` | UUID | Unique client identifier |
| `business_name` | TEXT | Company name |
| `contact_name` | TEXT | Contact person name |
| `name` | TEXT | User name |
| `email` | TEXT | Unique email address |
| `password_hash` | TEXT | Hashed password |
| `api_key` | TEXT | Unique API key for lead submission |
| `language` | TEXT | Preferred language (en/fr) |
| `is_internal` | BOOLEAN | Flag for Avenir's internal client |
| `is_test` | BOOLEAN | Flag for test data |
| `industry_category` | TEXT | Industry (Real Estate, Marketing, etc.) |
| `primary_service` | TEXT | Main service offered |
| `booking_link` | TEXT | Calendar/booking URL |
| `custom_tagline` | TEXT | Email signature tagline |
| `email_tone` | TEXT | Email tone (Friendly, Professional, etc.) |
| `followup_speed` | TEXT | Response speed (Instant, Within 1 hour, etc.) |
| `ai_personalized_reply` | BOOLEAN | Enable AI personalization |
| `outbound_email` | TEXT | Custom SMTP sender email |
| `smtp_host` | TEXT | SMTP server host |
| `smtp_port` | INT | SMTP port |
| `smtp_username` | TEXT | SMTP username |
| `smtp_password` | TEXT | SMTP password |
| `created_at` | TIMESTAMPTZ | Account creation timestamp |
| `last_login` | TIMESTAMPTZ | Last login timestamp |
| `last_connection` | TIMESTAMPTZ | Last API connection |
| `last_rotated` | TIMESTAMPTZ | Last API key rotation |

### **Table: `public.lead_memory`**

Core lead storage with AI enrichment.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `name` | TEXT | Lead name |
| `email` | TEXT | Lead email |
| `message` | TEXT | Lead message/inquiry |
| `ai_summary` | TEXT | AI-generated summary |
| `intent` | TEXT | Detected intent |
| `tone` | TEXT | Communication tone |
| `urgency` | TEXT | Urgency level (High/Medium/Low) |
| `confidence_score` | NUMERIC | Confidence score (0-1) |
| `language` | TEXT | Lead language (en/fr) |
| `client_id` | UUID | Associated client (FK) |
| `current_tag` | TEXT | Current tag (Active, Follow-Up, etc.) |
| `archived` | BOOLEAN | Archive status |
| `deleted` | BOOLEAN | Deletion status |
| `is_test` | BOOLEAN | Test data flag |
| `timestamp` | TIMESTAMPTZ | Lead creation timestamp |
| `last_updated` | TIMESTAMPTZ | Last update timestamp |
| `tone_history` | JSONB | Historical tone changes |
| `urgency_history` | JSONB | Historical urgency changes |
| `confidence_history` | JSONB | Historical confidence changes |
| `relationship_insight` | TEXT | AI relationship analysis |

### **Table: `public.lead_actions`**

Lead activity history and tagging.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `lead_id` | UUID | Lead reference (FK) |
| `client_id` | UUID | Client reference (FK) |
| `action_type` | TEXT | Action type (insert, update, tag, etc.) |
| `tag` | TEXT | Applied tag |
| `conversion_outcome` | BOOLEAN | Conversion flag |
| `reversion_reason` | TEXT | Reason for reverting conversion |
| `timestamp` | TIMESTAMPTZ | Action timestamp |
| `is_test` | BOOLEAN | Test data flag |

### **Table: `public.prospect_candidates`**

Discovered prospects for outreach.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `business_name` | TEXT | Company name |
| `website` | TEXT | Company website |
| `contact_email` | TEXT | Contact email |
| `form_url` | TEXT | Contact form URL |
| `industry` | TEXT | Industry category |
| `region` | TEXT | Geographic region |
| `language` | TEXT | Preferred language |
| `response_score` | NUMERIC | Response quality score (0-100) |
| `automation_need_score` | NUMERIC | Automation need (0-100) |
| `contacted` | BOOLEAN | Outreach sent flag |
| `last_tested` | TIMESTAMPTZ | Last contact form test |
| `created_at` | TIMESTAMPTZ | Discovery timestamp |

### **Table: `public.growth_brain`**

AI learning snapshots and growth analytics.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `client_id` | UUID | Client reference (FK) |
| `insight_type` | TEXT | Type of insight |
| `insight_text` | TEXT | AI-generated insight |
| `confidence` | NUMERIC | Insight confidence |
| `created_at` | TIMESTAMPTZ | Generation timestamp |

### **Table: `public.growth_brain`**

Learning snapshots and AI memory.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `client_id` | UUID | Client reference (FK) |
| `event_type` | TEXT | Event type (conversion, reversion, etc.) |
| `learning_snapshot` | JSONB | AI learning data |
| `timestamp` | TIMESTAMPTZ | Event timestamp |

### **Table: `public.prospect_outreach_log`**

Outreach email tracking.

| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `prospect_id` | UUID | Prospect reference (FK) |
| `email_subject` | TEXT | Email subject line |
| `email_body` | TEXT | Email HTML body |
| `status` | TEXT | Status (sent, opened, replied, ignored) |
| `sent_at` | TIMESTAMPTZ | Send timestamp |

---

## üîÑ Data Flow

### **Lead Submission Flow**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Client Website ‚îÇ
‚îÇ  Contact Form   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ POST /api/lead
         ‚îÇ (with x-api-key)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /api/lead Route                    ‚îÇ
‚îÇ  1. Validate API key                ‚îÇ
‚îÇ  2. Detect client_id                ‚îÇ
‚îÇ  3. Check if lead exists (by email) ‚îÇ
‚îÇ  4. Enrich with AI (if new)         ‚îÇ
‚îÇ  5. Upsert to lead_memory           ‚îÇ
‚îÇ  6. Insert to lead_actions          ‚îÇ
‚îÇ  7. Fetch client settings           ‚îÇ
‚îÇ  8. Build personalized email        ‚îÇ
‚îÇ  9. Send email (Gmail or SMTP)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Supabase Database                  ‚îÇ
‚îÇ  ‚Ä¢ lead_memory (enriched lead)      ‚îÇ
‚îÇ  ‚Ä¢ lead_actions (history entry)     ‚îÇ
‚îÇ  ‚Ä¢ clients (update last_connection) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Client Dashboard                   ‚îÇ
‚îÇ  ‚Ä¢ Real-time lead display           ‚îÇ
‚îÇ  ‚Ä¢ AI analytics cards               ‚îÇ
‚îÇ  ‚Ä¢ Predictive Growth Engine         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Client Signup Flow**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /client/signup ‚îÇ
‚îÇ  Form Submission‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ POST /api/client/register
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /api/client/register               ‚îÇ
‚îÇ  1. Validate email uniqueness       ‚îÇ
‚îÇ  2. Hash password                   ‚îÇ
‚îÇ  3. Generate client_id + API key    ‚îÇ
‚îÇ  4. Detect is_test flag             ‚îÇ
‚îÇ  5. Insert to clients table         ‚îÇ
‚îÇ  6. Send welcome email              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /client/dashboard                  ‚îÇ
‚îÇ  Auto-login with session            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Prospect Intelligence Flow**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Admin: Run Prospect Scan           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ POST /api/prospect-intelligence/scan
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Prospect Pipeline                  ‚îÇ
‚îÇ  1. Crawler: Discover businesses    ‚îÇ
‚îÇ  2. Analyzer: Test contact forms    ‚îÇ
‚îÇ  3. Scorer: Calculate need (0-100)  ‚îÇ
‚îÇ  4. Outreach: Generate emails       ‚îÇ
‚îÇ  5. Save to prospect_candidates     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  /admin/prospect-intelligence       ‚îÇ
‚îÇ  ‚Ä¢ View discovered prospects        ‚îÇ
‚îÇ  ‚Ä¢ High-priority filtering          ‚îÇ
‚îÇ  ‚Ä¢ Metrics dashboard                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîó Integrations

### **1. Supabase**
- **Purpose:** PostgreSQL database + real-time subscriptions
- **Tables:** 8 main tables (clients, lead_memory, lead_actions, etc.)
- **Auth:** Service role key for admin, anon key for client
- **Features:** Row Level Security (RLS), real-time updates

### **2. OpenAI GPT-4o-mini**
- **Purpose:** AI enrichment and chat assistant
- **Endpoints:** `/api/chat`, `/api/lead` (enrichment)
- **Features:**
  - Intent detection
  - Tone analysis
  - Urgency scoring
  - Summary generation
  - Confidence scoring

### **3. Gmail API**
- **Purpose:** Send automated welcome and lead response emails
- **Auth:** OAuth 2.0 with refresh tokens
- **Dev Mode:** Skipped when `NODE_ENV=development`
- **Features:** HTML email templates, personalized content

### **4. SMTP (Client-Owned)**
- **Purpose:** Send emails from client's own domain
- **Config:** Stored in `clients` table (smtp_host, smtp_port, etc.)
- **Fallback:** Uses Gmail API if SMTP not configured

### **5. next-intl**
- **Purpose:** Internationalization (EN/FR)
- **Files:** `messages/en.json`, `messages/fr.json`
- **Features:**
  - Route-based locale detection
  - Message loading per locale
  - Translation helpers (`t()`)

### **6. Middleware (Smart Redirects)**
- **Purpose:** Auto-redirect base routes to locale-prefixed routes
- **Detection:** Cookie ‚Üí Browser language ‚Üí Default (en)
- **Routes:** 11 shortcut URLs supported

### **7. Vercel Cron Jobs**
- **Purpose:** Scheduled analytics refresh
- **Schedule:** Daily at 03:00 UTC
- **Endpoint:** `/api/intelligence-engine/cron`
- **Features:** Per-client and global analytics generation

---

## ‚ú® Key Features

### **üåê Bilingual Support**
- Complete EN/FR translations for all pages
- Locale-specific routing (`/en/*`, `/fr/*`)
- Smart redirect system for shortcut URLs
- Language toggle with triple persistence
- Bilingual email templates
- Locale-aware error messages

### **üéØ Lead Intelligence**
- AI-powered intent detection
- Tone and urgency analysis
- Confidence scoring (0-100%)
- Automatic tagging (Active, Follow-Up, Converted)
- Historical tracking (tone_history, urgency_history)
- Relationship insights

### **üìß Personalized Email Automation**
- Client-specific templates
- Dynamic tone adjustment (Friendly, Professional, Formal, Casual)
- Industry and service mentions
- Booking link CTAs
- Custom taglines
- SMTP integration
- Bilingual email generation

### **üîê Multi-Tenant Architecture**
- Client-scoped data isolation
- API key authentication
- Session-based authentication
- Admin override capabilities
- Command Center with client filtering
- Row Level Security (Supabase RLS)

### **üß† Prospect Intelligence**
- Autonomous prospect discovery
- Contact form testing
- Automation need scoring
- High-priority filtering
- Outreach email generation
- Performance metrics

### **üìä Analytics & Insights**
- Predictive Growth Engine
- Engagement scoring
- Urgency trend analysis
- Confidence insights
- Tone distribution
- Language ratio
- Lead activity timeline

### **üè∑Ô∏è Lead Management**
- Multi-tab view (Active, Converted, Archived, Deleted)
- Tagging system with modals
- Conversion tracking with outcomes
- Reversion with reason logging
- Search and filtering
- Real-time updates
- Growth Copilot sidebar

### **‚öôÔ∏è Settings & Customization**
- Client settings page (self-service)
- Admin settings page (override any client)
- Email template preview
- Auto-save with toast notifications
- Manual save button
- Industry and service configuration
- Tone and speed preferences

### **üß™ Test Data Isolation**
- `is_test` flag across all tables
- Auto-detection (email contains "test" or "example.com")
- Admin dashboard toggle to show/hide test data
- Default view: production data only

### **üîÑ Smart Redirect System**
- 11 base routes with auto-redirect
- Cookie-based preference
- Browser language detection
- Default fallback (en)
- Middleware implementation

---

## üîß Configuration Files

| File | Purpose |
|------|---------|
| `next.config.ts` | Next.js config with next-intl plugin |
| `tsconfig.json` | TypeScript configuration |
| `tailwind.config.js` | Tailwind CSS configuration |
| `eslint.config.mjs` | ESLint rules |
| `postcss.config.mjs` | PostCSS configuration |
| `.env.local` | Environment variables (Supabase, OpenAI, etc.) |
| `src/i18n/routing.ts` | Locale routing configuration |
| `src/i18n/request.ts` | Message loading configuration |
| `src/middleware.ts` | Smart redirect middleware |

---

## üì¶ Dependencies

### **Core Framework**
- Next.js 15.5.4
- React 19.1.0
- TypeScript

### **UI & Animation**
- TailwindCSS
- Framer Motion 12.23.24

### **Backend & Database**
- @supabase/supabase-js 2.75.0
- @prisma/client 6.17.1

### **AI & Automation**
- openai 6.3.0 (GPT-4o-mini)

### **Email**
- googleapis 162.0.0 (Gmail API)
- Custom SMTP support

### **Authentication**
- bcryptjs 3.0.2

### **Internationalization**
- next-intl 4.3.12

### **Testing**
- @playwright/test 1.56.0

---

## üéØ System Health Metrics

| Component | Status | Notes |
|-----------|--------|-------|
| Public Site | ‚úÖ Operational | Bilingual, translations working |
| Client Signup | ‚úÖ Operational | API key generation, welcome emails |
| Client Login | ‚úÖ Operational | Session management, language restore |
| Client Dashboard | ‚úÖ Operational | Real-time analytics, lead management |
| Client Settings | ‚úÖ Operational | Auto-save, email preview |
| Admin Dashboard | ‚úÖ Operational | Command Center, client filtering |
| Admin Settings | ‚úÖ Operational | Client override capabilities |
| Lead API | ‚úÖ Operational | AI enrichment, email automation |
| Prospect Intelligence | ‚úÖ Operational | Discovery, scoring, outreach |
| Language Toggle | ‚úÖ Operational | Triple persistence, smart redirects |
| Email Automation | ‚úÖ Operational | Personalized templates, SMTP |
| AI Intelligence | ‚úÖ Operational | Intent, tone, urgency detection |
| Database | ‚úÖ Operational | Supabase, 8+ tables, RLS |
| Cron Jobs | ‚úÖ Operational | Daily analytics refresh |

---

## üîí Security Features

- ‚úÖ Password hashing (bcryptjs)
- ‚úÖ API key authentication
- ‚úÖ Session-based auth for dashboards
- ‚úÖ Admin password protection
- ‚úÖ Row Level Security (Supabase RLS)
- ‚úÖ Client data isolation (client_id scoping)
- ‚úÖ CORS headers for API endpoints
- ‚úÖ Input validation and sanitization
- ‚úÖ Environment variable protection
- ‚úÖ Test data separation (is_test flag)

---

## üìà Scalability Features

- ‚úÖ Multi-tenant architecture
- ‚úÖ Client-scoped data queries
- ‚úÖ Serverless API routes (Edge Runtime)
- ‚úÖ Static page generation (SSG)
- ‚úÖ Real-time database subscriptions
- ‚úÖ Vercel deployment optimizations
- ‚úÖ CDN caching
- ‚úÖ Middleware for smart routing

---

## üöÄ Deployment

**Platform:** Vercel  
**Domain:** https://www.aveniraisolutions.ca  
**Regions:** Global CDN  
**Build:** Automated via Git integration  
**Cron:** Vercel Cron Jobs (daily at 03:00 UTC)  

---

**End of System Blueprint**

---

*For detailed testing instructions, see `AVENIR_AI_SYSTEM_E2E_REPORT.md`*

